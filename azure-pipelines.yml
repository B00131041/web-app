trigger:
  - main  

variables:
  dockerRegistryServiceConnection: '4a01d2e9-19e1-417c-847c-6036aee46263'  
  imageRepository: 'bwebapp'  
  containerRegistry: 'ca2registry.azurecr.io' 
  dockerfilePath: '$(Build.SourcesDirectory)/Dockerfile'  
  tag: '$(Build.BuildId)' 
  vmImageName: 'ubuntu-latest'  
  PORT: '3000'  

stages:
  - stage: BuildAndPush
    displayName: Build and Push Docker Image
    jobs:
      - job: Build
        displayName: Build Docker Image and Push to ACR
        pool:
          vmImage: $(vmImageName)  
        steps:
          # Checkout the code from the repository
          - task: Checkout@1
            displayName: Checkout Code

          # Build and push Docker image to ACR
          - task: Docker@2
            displayName: Build and Push Docker Image
            inputs:
              command: buildAndPush
              repository: $(imageRepository)
              dockerfile: $(dockerfilePath)
              containerRegistry: $(dockerRegistryServiceConnection)
              tags: |
                $(tag)  # Tag using Build ID
                latest  # Optional tag as 'latest'